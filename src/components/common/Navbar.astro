---
// File: src/components/common/Navbar.astro
import { Image } from "astro:assets";
// Pastikan path ini benar (Mundur 2 folder)
import logoImage from "../../assets/images/common/uin-suska.png";

import { menuItems, siteConfig } from "../../data/navigation";

// PROPS
const { transparentMode = false, isContentPage = false } = Astro.props;

// LOGIC STYLE VISUAL
const contentStyle = "bg-slate-900 border-b border-slate-800";
const defaultStyle =
  "bg-slate-900/95 backdrop-blur-md border-white/10 shadow-sm";
const transparentStyle = "bg-transparent border-transparent";

const currentPath = Astro.url.pathname;
const isActive = (path: string) => {
  if (path === "/") return currentPath === "/";
  return currentPath.startsWith(path);
};
---

<header
  id="main-header"
  data-transparent-mode={transparentMode}
  class:list={[
    "fixed w-full top-0 z-50 transition-all duration-300",
    transparentMode
      ? transparentStyle
      : isContentPage
        ? contentStyle
        : defaultStyle,
  ]}
>
  <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
    <a
      href="/"
      class="flex items-center gap-3 group focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 rounded-lg p-1"
    >
      <div
        class="transition-transform group-hover:scale-110 duration-300 group-active:scale-95"
      >
        <Image
          src={logoImage}
          alt={`Lambang ${siteConfig.title}`}
          class="w-9 h-9 object-contain drop-shadow-md"
        />
      </div>

      <div class="flex flex-col">
        <span
          class:list={[
            "text-white font-bold text-lg leading-tight tracking-tight group-hover:text-emerald-400 transition font-sans",
            !isContentPage && "shadow-black drop-shadow-md",
          ]}
        >
          {siteConfig.title}
        </span>
      </div>
    </a>

    <nav class="hidden md:flex items-center gap-6" aria-label="Main Navigation">
      <ul class="flex gap-6 items-center">
        {
          menuItems.map((item) => (
            <li class="relative group focus-within:opacity-100">
              <a
                href={item.path}
                class:list={[
                  "text-sm font-medium transition-colors duration-200 flex items-center gap-1 py-2 font-sans focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 rounded",
                  !isContentPage && "shadow-black drop-shadow-sm",
                  isActive(item.path)
                    ? "text-emerald-400 font-bold"
                    : "text-slate-100 hover:text-emerald-300",
                ]}
              >
                {item.title}
                {item.children && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-3 w-3 opacity-70 group-hover:rotate-180 group-focus-within:rotate-180 transition-transform"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                )}
              </a>

              {/* Dropdown Desktop */}
              {item.children && (
                <div class="absolute left-0 mt-0 w-48 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200 transform origin-top-left translate-y-2 group-hover:translate-y-0 group-focus-within:translate-y-0 pt-2">
                  <div class="bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden p-1">
                    {item.children.map((subItem) => (
                      <a
                        href={subItem.path}
                        class="block px-4 py-2 text-sm text-slate-300 hover:bg-emerald-600 hover:text-white focus:bg-emerald-600 focus:text-white rounded-md transition-colors font-sans focus:outline-none"
                      >
                        {subItem.title}
                      </a>
                    ))}
                  </div>
                </div>
              )}
            </li>
          ))
        }
      </ul>

      <div class="flex items-center gap-4">
        <button
          id="search-btn"
          class="text-slate-100 hover:text-emerald-400 transition p-2 rounded-full hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400"
          aria-label="Cari Informasi"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        <a
          href={siteConfig.siakadUrl}
          target="_blank"
          class="hidden lg:block bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold px-4 py-2 rounded-full transition shadow-lg shadow-emerald-900/20 font-sans focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-slate-900"
        >
          SIAKAD
        </a>
      </div>
    </nav>

    <button
      id="mobile-menu-btn"
      class="md:hidden text-slate-100 hover:text-emerald-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 rounded p-1"
      aria-label="Buka Menu Navigasi"
    >
      <svg
        class="w-7 h-7"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>

  <div
    id="mobile-menu"
    class="hidden md:hidden bg-slate-900 border-t border-slate-800 absolute w-full left-0 top-full shadow-xl h-[calc(100vh-64px)] overflow-y-auto"
  >
    <ul class="flex flex-col p-4 space-y-1 pb-20">
      <li class="mb-4 pb-4 border-b border-slate-800">
        <div class="relative">
          <input
            type="text"
            placeholder="Cari info..."
            class="w-full bg-slate-800 text-slate-200 rounded-lg py-2.5 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm font-sans border border-slate-700"
          />
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 absolute left-3 top-3.5 text-slate-500"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
      </li>
      {
        menuItems.map((item) => (
          <li>
            {item.children ? (
              <details class="group" open={isActive(item.path)}>
                {/* PERBAIKAN DISINI:
                   Tambahkan logika isActive(item.path) pada class summary.
                   Jika path cocok (misal sedang di /profil/dosen), maka judul "Profil" jadi hijau.
                */}
                <summary
                  class:list={[
                    "flex justify-between items-center py-3 px-3 hover:bg-slate-800 rounded-lg cursor-pointer font-sans font-medium transition-colors focus:outline-none focus:bg-slate-800 select-none",
                    isActive(item.path)
                      ? "text-emerald-400 font-bold bg-slate-800/50"
                      : "text-slate-300",
                  ]}
                >
                  {item.title}
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class:list={[
                      "h-4 w-4 transition-transform text-slate-500",
                      // Putar panah otomatis jika aktif
                      isActive(item.path)
                        ? "rotate-180 text-emerald-500"
                        : "group-open:rotate-180",
                    ]}
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </summary>

                <div class="pl-4 border-l-2 border-slate-700 ml-3 mt-1 space-y-1">
                  {item.children.map((subItem) => (
                    <a
                      href={subItem.path}
                      class:list={[
                        "block text-sm py-2 pl-2 font-sans focus:outline-none transition-colors rounded-r",
                        // Highlight juga sub-item yang sedang aktif
                        currentPath === subItem.path
                          ? "text-emerald-400 font-bold bg-emerald-500/10 border-l-2 border-emerald-500 -ml-0.5"
                          : "text-slate-400 hover:text-emerald-400",
                      ]}
                    >
                      {subItem.title}
                    </a>
                  ))}
                </div>
              </details>
            ) : (
              // MENU TANPA ANAK (Beranda, Berita, dll) - Sudah Benar
              <a
                href={item.path}
                class:list={[
                  "block py-3 px-3 rounded-lg font-sans font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500",
                  isActive(item.path)
                    ? "bg-emerald-600/10 text-emerald-400 font-bold border-l-4 border-emerald-500"
                    : "text-slate-300 hover:bg-slate-800",
                ]}
              >
                {item.title}
              </a>
            )}
          </li>
        ))
      }
    </ul>
  </div>
</header>

<div
  id="search-overlay"
  class="fixed inset-0 z-100 bg-slate-900/60 backdrop-blur-sm hidden items-start justify-center pt-24 px-4 opacity-0 transition-opacity duration-300"
>
  <div
    class="w-full max-w-xl bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl transform scale-95 transition-all duration-300 flex flex-col relative"
    id="search-container"
  >
    <div class="relative border-b border-slate-700 p-4">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 absolute left-6 top-5 text-emerald-500"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input
        type="text"
        id="global-search-input"
        placeholder="Cari Dosen, Berita, atau Dokumen..."
        class="w-full bg-transparent text-white text-lg rounded-lg py-1 pl-12 pr-12 focus:outline-none placeholder-slate-500 font-sans h-10"
        autocomplete="off"
      />
      <button
        id="close-search"
        class="absolute right-4 top-4 text-slate-400 hover:text-white bg-slate-800 hover:bg-slate-700 p-1 rounded-md transition"
      >
        <span class="sr-only">Tutup</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>
    <div class="p-4 bg-slate-800/50 rounded-b-2xl">
      <p
        class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3 ml-2"
      >
        Saran Cepat
      </p>
      <div class="space-y-1">
        <a
          href="/akademik/kurikulum"
          class="flex items-center gap-3 p-3 rounded-lg hover:bg-slate-700/50 group transition-colors"
        >
          <div
            class="bg-emerald-500/10 p-2 rounded-md text-emerald-400 group-hover:bg-emerald-500 group-hover:text-white transition-colors"
          >
            <span class="text-xs font-bold">K</span>
          </div>
          <span
            class="text-slate-200 text-sm font-medium group-hover:text-emerald-400"
            >Kurikulum 2025</span
          >
        </a>
      </div>
      <div
        class="mt-4 pt-3 border-t border-slate-700/50 flex justify-between items-center text-xs text-slate-500"
      >
        <span
          >Tekan <kbd class="font-mono bg-slate-700 px-1 rounded text-slate-300"
            >Esc</kbd
          > untuk tutup</span
        >
      </div>
    </div>
  </div>
</div>

<script src="../../scripts/ui/navbar.js"></script>
<script src="../../scripts/ui/search.js"></script>
